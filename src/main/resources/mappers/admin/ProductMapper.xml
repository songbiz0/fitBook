<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fitbook.admin.AdminMapper">
    <sql id="searchIf">
        <where>
            B.isrep = 'Y'
            <if test="select != null">
                AND (B.isrep = 'Y' AND ${select} LIKE CONCAT('%',#{search},'%'))
            </if>
            <if test="total != null">
                OR(B.isrep = 'Y' AND ${total} LIKE CONCAT('%',#{search},'%'))
            </if>
        </where>
    </sql>

    <select id="selProductList" resultType="ProductVo">
        SELECT * FROM (
        SELECT A.iproduct, A.nm, A.product_code,A.brand,
        B.img, B.stock, B.price, B.idetail
        FROM t_product_master A
        INNER JOIN t_product_detail B
        ON A.iproduct = B.iproduct
         <include refid="searchIf">

         </include>
        ORDER BY A.iproduct = ${iproduct} DESC
        LIMIT ${startIdx}, ${recordCount} ) AS t
    </select>

    <select id="selMaxPageVal" resultType="resultVo">
        SELECT CEIL((count(A.iproduct)) / ${recordCount}) AS result
        FROM t_product_master A
        INNER JOIN t_product_detail B
        ON A.iproduct = B.iproduct
        WHERE isrep = 'Y'
    </select>

    <select id="selProductDetail" resultType="ProductVo">
        SELECT B.price, C.nm as cpu, D.nm as gpu, A.ram, B.ssd, B.hdd,
               A.size, A.weight, A.os, B.color, A.rdt, B.stock
        FROM t_product_master A
                 INNER JOIN t_product_detail B
                            ON A.iproduct = B.iproduct
                 INNER JOIN t_product_cpu C
                            ON A.icpu = C.icpu
                 INNER JOIN t_product_gpu D
                            ON A.igpu = D.igpu
        WHERE A.iproduct = ${iproduct}
        ORDER BY isrep DESC;
    </select>

    <select id="selProductDetail2" resultType="ProductVo">
        SELECT A.product_code, A.nm, A.rdt, B.img, A.brand, B.idetail
        FROM t_product_master A
        INNER JOIN t_product_detail B
        ON A.iproduct = B.iproduct
        WHERE B.isrep = 'Y'
        AND A.iproduct = ${iproduct};
    </select>

    <insert id="insProductMaster" useGeneratedKeys="true" keyProperty="iproduct" keyColumn="iproduct">
        INSERT INTO t_product_master
        (nm, product_code, rdt, icpu, igpu, ram, size, weight, brand, os, img)
        VALUES
        (#{nm}, #{product_code}, #{rdt}, ${icpu}, ${igpu}, ${ram}, ${size}, ${weight}, #{brand}, #{os}, #{img})
    </insert>

    <insert id="insProductDetail" useGeneratedKeys="true" keyProperty="idetail" keyColumn="idetail">
        INSERT INTO t_product_detail
        (iproduct, color, hdd, ssd, price, stock, isrep, dc_rate, img)
        VALUES
        (${iproduct}, #{color}, ${hdd}, ${ssd}, ${price}, ${stock}, #{isrep}, ${dc_rate}, #{img})
    </insert>
</mapper>