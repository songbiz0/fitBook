<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fitbook.admin.AdminMapper">
    <insert id="insProgram" useGeneratedKeys="true" keyProperty="iprogram" keyColumn="iprogram">
        INSERT INTO t_program
        (nm, required_cpu, required_gpu, required_ram, img)
        VALUES
        (#{nm}, ${required_cpu}, ${required_gpu}, ${required_ram}, #{img})
    </insert>

    <select id="selProgramMaxPage" resultType="ResultVo">
        SELECT CEIL(COUNT(iprogram) / ${rowCnt}) AS result
        FROM t_program
        <if test="search != null">
            WHERE nm LIKE CONCAT('%', #{search}, '%')
        </if>
    </select>

    <select id="selProgramList" resultType="ProgramVo">
        SELECT *
        FROM
        <if test="cpu != 0">
            (
            SELECT *
            FROM
            <if test="cpu == 1">
                (
                SELECT *
                FROM t_program
                LIMIT 0, 3) AS t ) t_program
                ORDER BY required_cpu
            </if>
            <if test="cpu == 2">
                (
                SELECT *
                FROM t_program
                LIMIT 0, 3) AS t ) t_program
                ORDER BY required_cpu DESC
            </if>
        </if>
        <if test="cpu == 0">
            t_program
        </if>

        <if test="gpu == 1">
            ORDER BY required_gpu
        </if>
        <if test="gpu == 2">
            ORDER BY required_gpu DESC
        </if>
        <if test="ram == 1">
            ORDER BY required_ram
        </if>
        <if test="ram == 2">
            ORDER BY required_ram DESC
        </if>
        <if test="search != null and search != ''">
            WHERE nm LIKE CONCAT('%', #{search}, '%')
        </if>
        <if test="search == null">
            WHERE nm LIKE '%%'
        </if>
        LIMIT ${startIdx}, ${rowCnt}
    </select>
</mapper>