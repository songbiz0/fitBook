<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fitbook.admin.AdminMapper">
    <sql id="selPartsList">
        SELECT *
        FROM (
        SELECT *
        FROM ${parts}
        WHERE
        <choose>
            <when test="select != null">${select} LIKE CONCAT('%', #{search}, '%')</when>
            <otherwise>
                nm LIKE '%%'
                OR brand LIKE '%%'
            </otherwise>
        </choose>
        LIMIT ${startIdx}, ${rowCnt}) AS t
        <choose>
            <when test="typeNo == 1"> ORDER BY ${type} </when>
            <when test="typeNo == 2"> ORDER BY ${type} DESC </when>
        </choose>
    </sql>
    
    <insert id="insGpu">
        INSERT INTO t_product_gpu
        (nm, performance, seq, brand)
        VALUES
        (#{nm}, ${performance}, ${seq}, #{brand})
    </insert>

    <insert id="insCpu">
        INSERT INTO t_product_cpu
        (nm, performance, inner_gpu, seq, brand)
        VALUES
        (#{nm}, ${performance}, ${inner_gpu}, ${seq}, #{brand})
    </insert>

    <select id="selGpu" resultType="GpuVo">
        SELECT *
        FROM t_product_gpu
        ORDER BY seq DESC, brand
    </select>

    <select id="selCpu" resultType="CpuVo">
        SELECT *
        FROM t_product_cpu
        ORDER BY seq DESC, brand
    </select>

    <select id="selMaxPage" resultType="ResultVo">
        SELECT CEIL(COUNT(nm) / ${rowCnt}) AS result
        FROM ${parts}
        <where>
        <if test="search != null and search != '' or select != null and select != ''">
            ${select} LIKE CONCAT('%', #{search}, '%')
        </if>
        </where>
    </select>

    <select id="selCpuList" resultType="CpuVo">
        <include refid="selPartsList"></include>
    </select>

    <select id="selGpuList" resultType="GpuVo">
        <include refid="selPartsList"></include>
    </select>
</mapper>